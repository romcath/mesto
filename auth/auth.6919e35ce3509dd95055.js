(()=>{"use strict";var e=document.querySelector(".header"),t=(document.querySelector(".content"),document.querySelector(".places-list"),document.querySelector(".root")),n=document.querySelector(".auth_type_signup"),o=document.querySelector(".auth_type_login"),i=(document.querySelector(".popup_type_edit-profile"),document.querySelector(".popup_type_new-card"),document.querySelector(".popup_type_image"),document.querySelector(".popup_type_avatar"),document.querySelector(".popup_type_remove-card"),document.querySelector(".popup_type_success"),document.querySelector(".popup_type_fail")),r=(document.querySelector(".user-info__button-edit"),document.querySelector(".user-info__button-add"),document.querySelector(".user-info__photo"),document.querySelector(".form__button_type_edit"),document.querySelector(".form__button_new-card"),document.querySelector(".form__button_avatar"),document.querySelector(".user-info__name"),document.querySelector(".user-info__job"),document.querySelector(".user-info__photo"),document.querySelector(".form__input_type_name"),document.querySelector(".form__input_type_about"),{formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",activeButtonClass:"form__button_enabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"}),s={menuSelector:".menu",openMobileMenuSelector:".header__menu-icon",buttonSelector:".menu__button",emailSelector:".menu__email",mobileMenuClass:"menu_type_mobile",closeMobileMenuClass:"header__menu-icon_close",rootTransformClass:"root__transform"};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=function(){function e(t){var n=t.authElement,o=t.handleFormSubmit,i=t.handleLinkClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=n,this._handleFormSubmit=o,this._handleLinkClick=i||function(){},this._handleLinkClick=this._handleLinkClick.bind(this)}var t,n;return t=e,(n=[{key:"setEventListeners",value:function(){var e=this;this._element.querySelector(".auth__link").addEventListener("click",this._handleLinkClick),this._element.addEventListener("submit",(function(t){t.preventDefault(),e._handleFormSubmit()}))}},{key:"open",value:function(){this._element.classList.add("auth_is-opened")}},{key:"close",value:function(){this._element.classList.remove("auth_is-opened")}}])&&a(t.prototype,n),e}();function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._activeButtonClass=t.activeButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._element=n}var t,n;return t=e,(n=[{key:"getInputValues",value:function(){var e=this,t=this._element.querySelectorAll(".form__input");return this._formValues={},t.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_showInputError",value:function(e,t){var n=this._element.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._element.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}},{key:"toggleButtonState",value:function(e,t){this._getInvalidInput(e)?(t.classList.remove(this._activeButtonClass),t.disabled=!0):(t.classList.add(this._activeButtonClass),t.disabled=!1)}},{key:"_getInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"enableValidation",value:function(){var e=this;this._inputList=Array.from(this._element.querySelectorAll(this._inputSelector)),this._buttonElement=this._element.querySelector(this._submitButtonSelector),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.toggleButtonState(e._inputList,e._buttonElement)}))}))}},{key:"resetSpans",value:function(){this._spanList=Array.from(this._element.querySelectorAll(".form__error")),this._inputList.forEach((function(e){return e.classList.remove("form__input_type_error")})),this._spanList.forEach((function(e){e.classList.remove("form__error_visible"),e.textContent=""}))}}])&&u(t.prototype,n),e}();function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=t}var t,n;return t=e,(n=[{key:"signup",value:function(e){var t=e.email,n=e.password;return fetch("".concat(this._options.baseUrl,"/signup"),{redirect:"follow",credentials:"include",method:"POST",headers:this._options.headers,body:JSON.stringify({email:t,password:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"signin",value:function(e){var t=e.email,n=e.password;return fetch("".concat(this._options.baseUrl,"/signin"),{redirect:"follow",credentials:"include",method:"POST",headers:this._options.headers,body:JSON.stringify({email:t,password:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"logout",value:function(){return fetch("".concat(this._options.baseUrl,"/logout"),{redirect:"follow",credentials:"include",method:"POST",headers:this._options.headers,body:JSON.stringify({})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getAppInfo",value:function(){return Promise.all([this.getCardList(),this.getUserInfo()])}},{key:"getCardList",value:function(){return fetch("".concat(this._options.baseUrl,"/cards"),{redirect:"follow",credentials:"include",headers:this._options.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._options.baseUrl,"/users/me"),{redirect:"follow",credentials:"include",headers:this._options.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"changeLikeCard",value:function(e,t){return fetch("".concat(this._options.baseUrl,"/cards/like/").concat(e),{method:t?"DELETE":"PUT",redirect:"follow",credentials:"include",headers:this._options.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"removeCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",redirect:"follow",credentials:"include",headers:this._options.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"addCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",redirect:"follow",credentials:"include",headers:this._options.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",redirect:"follow",credentials:"include",headers:this._options.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"setUserAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",redirect:"follow",credentials:"include",headers:this._options.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}}])&&h(t.prototype,n),e}();function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=t,this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){e.preventDefault(),27===e.which&&this.close()}},{key:"_handleClickCloseButton",value:function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}},{key:"open",value:function(){this._popupElement.classList.add("popup_is-opened"),document.addEventListener("keyup",this._handleEscClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_is-opened"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._popupElement.addEventListener("click",this._handleClickCloseButton.bind(this))}}])&&_(t.prototype,n),e}();function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function e(t,n){var o=t.headerElement,i=t.rootElement,r=t.handleHeaderClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._headerElement=o,this._rootElement=i,this._buttonSelector=n.buttonSelector,this._emailSelector=n.emailSelector,this._mobileMenuClass=n.mobileMenuClass,this._closeMobileMenuClass=n.closeMobileMenuClass,this._rootTransformClass=n.rootTransformClass,this._headerMenu=this._headerElement.querySelector(n.menuSelector),this._mobileMenuButton=this._headerElement.querySelector(n.openMobileMenuSelector),this._handleHeaderClick=r||function(){},this._handleHeaderClick=this._handleHeaderClick.bind(this),this.openMobileMenu=this.openMobileMenu.bind(this),this.closeMenuMobile=this.closeMenuMobile.bind(this),this._mobileMenuButton.addEventListener("click",this.openMobileMenu)}var t,n;return t=e,(n=[{key:"render",value:function(e,t,n){this._menuButton=this._headerElement.querySelector(this._buttonSelector),e?(this._headerElement.querySelector(this._emailSelector).textContent=n,this._menuButton.textContent=t,this._setEventListener(this._menuButton,"click",this._handleHeaderClick)):(this._menuButton.textContent=t,this._setEventListener(this._menuButton,"click",this._handleHeaderClick))}},{key:"_setEventListener",value:function(e,t,n){e.addEventListener(t,n)}},{key:"removeEventListener",value:function(){this._menuButton.removeEventListener("click",this._handleHeaderClick)}},{key:"_removeEventListenerMobileMenu",value:function(e,t,n){e.removeEventListener(t,n)}},{key:"openMobileMenu",value:function(){this._rootElement.classList.add(this._rootTransformClass),this._headerMenu.classList.add(this._mobileMenuClass),this._mobileMenuButton.classList.add(this._closeMobileMenuClass),this._removeEventListenerMobileMenu(this._mobileMenuButton,"click",this.openMobileMenu),this._setEventListener(this._mobileMenuButton,"click",this.closeMenuMobile)}},{key:"closeMenuMobile",value:function(){this._rootElement.classList.remove(this._rootTransformClass),this._headerMenu.classList.remove(this._mobileMenuClass),this._mobileMenuButton.classList.remove(this._closeMobileMenuClass),this._removeEventListenerMobileMenu(this._mobileMenuButton,"click",this.closeMenuMobile),this._setEventListener(this._mobileMenuButton,"click",this.openMobileMenu)}}])&&f(t.prototype,n),e}(),v=new d({baseUrl:"https://api.mesto.cf",headers:{"Content-Type":"application/json"}}),y=new m(i);y.setEventListeners();var b=new c(r,o);b.enableValidation();var k=new c(r,n);k.enableValidation();var S=new p({headerElement:e,rootElement:t,handleHeaderClick:function(){L.close(),C.open(),S.removeEventListener(),E.render(!1,"Войти")}},s),E=new p({headerElement:e,rootElement:t,handleHeaderClick:function(){C.close(),L.open(),E.removeEventListener(),S.render(!1,"Регистрация")}},s);E.render(!1,"Войти");var C=new l({authElement:n,handleFormSubmit:function(){var e=k.getInputValues();v.signup(e).then((function(){v.signin(e).then((function(){localStorage.setItem("loginState","true"),localStorage.setItem("signupState","true"),window.location.replace("./index.html")})).catch((function(e){y.open(),console.log("Ошибка входа пользователя: ".concat(e))}))})).catch((function(e){y.open(),console.log("Ошибка регистрации пользователя: ".concat(e))}))},handleLinkClick:function(){C.close(),L.open(),S.render(!1,"Регистрация")}});C.setEventListeners();var L=new l({authElement:o,handleFormSubmit:function(){var e=b.getInputValues();v.signin(e).then((function(){localStorage.setItem("loginState","true"),window.location.replace("./index.html")})).catch((function(e){y.open(),console.log("Ошибка входа пользователя: ".concat(e))}))},handleLinkClick:function(){L.close(),C.open(),E.render(!1,"Войти")}});L.setEventListeners()})();